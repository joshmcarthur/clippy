<% provide(:title, @upload.name) %>

<div class="container-fluid container-lg my-5" data-controller="upload-sync">
  <%= link_to "â†° All uploads", uploads_path, class: "d-block mb-3" %>

  <div class="row align-items-center mb-5">
    <div class="col-12 col-lg">
      <h1><%= @upload.name %></h1>
    </div>
    <div class="col-auto">
      <div>
        Created at
        <%= time_tag @upload.created_at, localize(@upload.created_at, format: :long) %>
      </div>

      <div>
        Duration:
        <%= Time.at(@upload.audio.metadata["duration"]).utc.strftime("%H:%M:%S") %>
      </div>
    </div>
    <div class="col text-end col-lg-auto">
      <%= link_to "Edit", edit_upload_path(@upload), class: "btn btn-primary" %>
      <%= link_to "Delete", @upload, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-danger" %>
    </div>
  </div>

  <div class="row mb-5">
    <div class="col-12 col-lg-9 fw-semibold">
      <%= simple_format @upload.summary&.text %>
    </div>

    <div class="col-12 col-lg-9 mb-4">
      <% @upload.summary&.entities.each do |entity| %>
        <%= content_tag :span, "#{entity["name"] || entity["entity"]} (#{entity["type"]})", class: "badge fs-6 my-2 bg-transparent border text-wrap" %>
      <% end %>
    </div>

    <div class="col-5 col-lg-6">
      <% if @upload.video? %>
        <video
          controls
          class="mw-100 w-100 object-fit-contain rounded sticky-top mb-4"
          style="top: 20px;"
          poster="<%= url_for(@upload.file.preview(resize_to_fit: [1920, 1080])) %>"
          data-upload-sync-target="media">
          <source src="<%= url_for(@upload.file) %>" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      <% elsif @upload.audio? %>
        <audio controls>
          <source src="<%= url_for(@upload.audio_url) %>" type="audio/mpeg">
          Your browser does not support the audio tag.
        </audio>
      <% else %>
        No preview is available for this file. <br>
        <%= link_to "Download", url_for(@upload.file), target: "_blank", download: true %>
      <% end %>

    </div>

    <div class="col-7 col-lg-6">
      <%= render "transcript", upload: @upload %>
    </div>
  </div>
</div>
