
<section data-upload-sync-target="transcript" class="position-relative">
<%= form_with model: Clip.new, html: { data: { transcript_clip_target: "toolbar" }, style: "top: var(--top); left: var(--left);", class: "position-absolute d-none z-1" } do |f| %>
  <%= f.hidden_field :start_segment_id, data: { transcript_clip_target: "segmentStartInput" } %>
  <%= f.hidden_field :end_segment_id, data: { transcript_clip_target: "segmentEndInput" } %>
  <%= f.button "âœ‚ Clip", class: "btn btn-sm btn-primary" %>
<% end %>

<% start_of_section = true %>
<% upload.transcript.segments.each do |segment| %>
  <span class="transcript-segment" data-segment-id="<%= segment.to_param %>" id="<%= dom_id(segment) %>" data-starts="<%= segment.range.first %>" data-ends="<%= segment.range.last %>">
    <%= content_tag :a,
                    "[#{Time.at(segment.range.first).utc.strftime("%H:%M:%S")}]",
                    href: "##{dom_id(segment)}",
                    data: { action: "upload-sync#scrubTo", starts: segment.range.first, ends: segment.range.last },
                    class: "user-select-none text-reset link-underline-light link-underline-opacity-0 link-underline-opacity-75-hover" if start_of_section -%>
    <%= content_tag :span, segment.text,
                    class: ('bg-primary' if @upload.transcript.clips.any? { |clip| clip.range.overlap?(segment.range)}) %>
  </span>
  <% if segment.breaks? %>
    <% start_of_section = true %>
    <br /><br />
  <% else %>
    <% start_of_section = false %>
  <% end %>
<% end %>
</section>